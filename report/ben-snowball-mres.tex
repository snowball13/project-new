\documentclass[11pt, oneside]{article}   	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 
%\geometry{landscape}                		% Activate for rotated page geometry
\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex		
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{bbm}

%SetFonts

%SetFonts

\newcommand{\R}{\mathbb{R}}
\newcommand{\MN}{\mathbb{M}_N}
\newcommand{\LN}{\mathbb{L}_N}
\newcommand{\dsm}{d_\mathbb{S}(m)}
\newcommand{\dsmsq}{d^{2}_{\mathbb{S}}(m)}
\newcommand{\graddsmsq}{\nabla{d^{2}_{\mathbb{S}}(m)}}
\newcommand{\eone}{\hat{e}_1}
\newcommand{\etwo}{\hat{e}_2}
\newcommand{\bt}{\tilde{b}}
\newcommand{\pt}{\tilde{p}}
\newcommand{\dt}{\Delta t}
\newcommand{\M}{\mathbb{M}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Sb}{\mathbb{S}}
\newcommand{\Ps}{\mathbb{P}_{\mathbb{S}}}
\newcommand{\Pm}{\mathbb{P}_{\mathbb{M}_N}}
\newcommand{\Leb}{\mathrm{Leb}}
\newcommand{\DmDt}{\frac{\mathrm{D}m}{\mathrm{D}t}}
\newcommand{\DuDt}{\frac{\mathrm{D}u}{\mathrm{D}t}}


\title{MRes Report}
\author{Ben Snowball}
%\date{}							% Activate to display a given date or no date


\begin{document}



\maketitle
\section{Introduction}

The main goal of this paper is to investigate whether using a new optimal transport timestepping method can be used to simulate an Eady model describing weather fronts. The ultimate aim is to apply the method to the model, and see how it compares to the Eulerian solution. The theory is that a Lagrangian framed approach might better resolve the frontal problem in weather forecasting.

In Section 2 of this report, we provide some background on optimal transport approach and a symplectic timestepping method that will be part of our new method. In Section 3 we propose the method, and detail how our program works when applied to two examples: a simple Beltrami flow in a unit square, and a situation of a number of vortices placed in a unit square. We then in Section 4 present some results and finally give an outlook on where this work can head next in Section 5.


\section{Background}

\subsection{Optimal Transport Approach}

The Euler equations describe fluid particle motion under an incompressibility constraint. 

Brenier (ref) introduced the idea of "distance" between a Lagrangian flow map and the space of measure preserving maps, which naturally leads to the constraint of incompressibility being equivalent to this distance being zero. Consider two maps \(m_1, m_2 \: : \: \Omega \to \Omega\) for some domain \(\Omega \subset \R^n, \: n \in \N\). We can define a distance between these two maps simply by using the \(L^2\)-norm, i.e. letting \(\M := L^2(\Omega)\), 
\begin{align}
d^2(m_1, m_2) := \int_\Omega || m_1(a) - m_2(a) || \: \mathrm{d}^2 a, \quad m_1, m_2 \in \M.
\end{align}

We can extend this to define a notion of distance for any map in \(\M\) to the set of measure preserving maps of \(\M\). Denoting \(\Sb\) as this set, i.e. 
\begin{align}
\Sb &= \{ \: s \in \M \quad | \quad s_{\#}\Leb(A) := \Leb(s^{-1}(A)) = \Leb(A) \quad \forall A \subset \Omega \},
\end{align}
(so \(\Sb \subset \M\)) we can define the (squared) distance from a map in \(\M\) to the set \(\Sb\) by \(d^2_\Sb \: : \: \M \to \R\) where
\begin{align}
\dsmsq := \min_{s \in \mathbb{S}} d^2(m, s), \quad m \in \M.
\end{align}

Now, for \(N \in \N\), we define a tessellation partition \(P_N\) of \(\Omega\) into \(N\) subsets \(\omega_i, i=1,\dots,N\) such that:
\begin{align}
1)& \quad \Leb(\omega_i) = \frac{1}{N}\Leb(\Omega) \quad \forall i = 1,\dots,N \\
2)& \quad \max_{i = 1,\dots,N} \mathrm{diam}(\omega_i) \le CN^{-\frac{1}{2}}, \quad C \text{ independent of } N.
\end{align}
Then we define \(\MN\) to be the space of functions from \(\Omega\) to \(\R^n\) which are constant on each of the subdomains \(\omega_i\) of \(P_N\), i.e.
\begin{align}
\MN &= \{ \phi \: : \: \Omega \to \R^2 \quad | \quad \phi | _{\omega_i} \text{ is constant, } i = 1,\dots,N\}.
\end{align}
Note that of course our notion of distance for any map in \(\MN\) to \(\Sb\) still holds. Discretising in this way, i.e. representing functions as piecewise constant maps, allows us to store computationally a map as merely as set of points (the value of the map on each subdomain \(\omega_i\)).

The Hamiltonian approach for solving the problem is then: choose a set of variables \((m, u) \in \MN \times \MN \) that satisfy Hamilton's equations
\begin{align} 
\dot{m} &= u, \\
\dot{u} &= - \nabla p
\end{align}
where \(\nabla p = \frac{\graddsmsq}{2\epsilon^2}\). Here, \(\epsilon\) is the spring parameter. This is the system of equations corresponding to conserving the Hamiltonian
\begin{align} 
H(m, u) &= \frac{1}{2} ||u||^2_{L^2} + \frac{\dsmsq}{2\epsilon^2}.
\end{align}
Conserving the Hamiltonian keeps the system close to incompressible. 


From (reference for Quentin 1), a calculatable formula for \(\graddsmsq\) exists. First, we introduce the definition of a Laguerre diagram and briefly explain the projections used as part the formula. Let \(M = (M_1,\dots,M_N), \text{ where } M_i \in \R^2, \psi = (\psi_1,\dots,\psi_N), \text{ where } \psi_i \in \R\). The Laguerre diagram is a decomposition of \(\R^2\) into \(N\) convex polyhedra (Laguerre cells) defined by:
\begin{align}
\mathrm{Lag}_i(M, \psi) &= \{x \in \R^2 \quad | \quad || x - M_i ||^2 + \psi_i \le || x - M_j ||^2 + \psi_j, \quad \forall j = 1,\dots,N\}
\end{align}

Since \(\Sb\) is closed but not convex, the orthogonal projection of a map in \(\Sb\) exists, but is not uniquely defined. Thus it is simply given as any map that is a projection. In other words, a projection of \(m \in \M\), \(P_\Sb(m)\), is any point satisfying
\begin{align}
|| P_\Sb(m) - m || &= \dsmsq.
\end{align}
We also denote the orthogonal projection mapping on \(\MN\) by \(P_{\MN}\).

Proposition 1: Let \(m \in \MN\) and define \(M_i := m(\omega_i) \in \R^2 \text{ for } i = 1,\dots,N\) with \(M = (M_1,\dots,M_N)\). Then there exists \(\psi = (\psi_1,\dots,\psi_N), \psi \in \R\), unique up to additive constant such that, with \(L_i := \mathrm{Lag}_i(M, \psi)\), 
\begin{align}
\Leb(L_i) &= \frac{1}{N}\Leb(\Omega),
\end{align}
and
\begin{align}
\dsmsq & = \sum_{i=1}^N \: \int_{L_i} || x - M_i ||^2 \: \mathrm{d}x, \\
\graddsmsq &= 2(m - P_{\MN} \circ P_{\mathbb{S}}(m)),
\end{align}
where
\begin{align}
P_{\MN} \circ P_{\mathbb{S}}(m) &= \sum^N_{i=1} B_i \mathbbm{1}_{L_i}(m), \\
B_i &:= \frac{1}{\Leb(L_i)} \int_{L_i} x \: \mathrm{d}x, \quad i = 1,\dots,N. 
\end{align}

Equations (13, 14) above are implemented in a code Library [Q github link], which is used in [Quentin ref]. [Quentin ref] used a symplectic method (symplectic Euler) to discretise in time. A symplectic Hamiltonian is one that preserves phase space volume. (Consider a surface in the phase space made up of points of initial condition. At a time \(t\) each initial condition point will have been mapped to a new position in the phase space. If we consider all these new mappings to also make up a surface, then the flow was symplectic if the volume enclosed by the original surface is the same for that of the new surface. A timestepping method is symplectic if the volume is preserved at each timestep.)

Computationally, problems arose with extending this method to geophysical fluids problems due to the difficulty in tuning the \(\epsilon\) parameter. [More required]. The subsequent idea was to answer the question "how do we remove the need for \(\epsilon\) and get rid of compressibility?".

\subsection{RATTLE Algorithm}

[History]

[Paper] describes the RATTLE algorithm that we modify to be part of our timestepping method. Originally devised to be applied to molecular dynamics simulations, the RATTLE algorithm is used to solve constrained Hamiltonian equations. 

Hamiltonian systems of differential equations like (7, 8) have a flow that preserves a symplectic structure. Importantly, it has been established that symplectic methods have better long-term stability properties than non-symplectic methods. [RATTLE ref, 20]. RATTLE is an example of a Verlet method for constrained problems, which is symplectic.


\section{Method}

We can formulate the simple flow problem as a constrained problem as follows. The undiscretised incompressible Euler equations can be written in Lagrangian form as:
\begin{align}
& \dot{m}(a, t) = u(a,t), \quad \text{contraint}: \: \dsmsq = 0 \\
\iff
 &\begin{cases}
  \dot{m} = u \\
  \dot{u} = \lambda \graddsmsq, \quad \lambda = \lambda(t) \text{ a Lagrange multiplier enforcing } \dsmsq = 0.
 \end{cases} 
\end{align}

Restricting \(m\) to be in \(\MN\) would mean we cannot enforce the constraint. To address this, we choose an initial condition \(m(0) =: m^{(0)}\) and set
\begin{align}
c &:= d^{2}_{\mathbb{S}}(m^{(0)})
\end{align}

so \(c\) is independent of \(t\) and gives the "distance" from an incompressible state that the particles initially lie. We then solve
\begin{align}
 &\begin{cases}
  \dot{m} = u \\
  \dot{u} = \lambda \graddsmsq, \quad \lambda = \lambda(t) \text{ a Lagrange multiplier enforcing } \dsmsq = c.
 \end{cases} 
\end{align}
so that we keep the particle positions at this small initial distance \(c\) from incompressible.

Define, for each timestep \(n\), \(b^n := \nabla{d^{2}_{\Sb}(m^n)}\). Our modified RATTLE algorithm, applied to this problem, is then:

Algorithm 1:
\begin{flalign*}
 & \quad
 \begin{cases}
  m^{n+1} = m^{n} + \dt \; u^{n+1/2}  \\
  u^{n+1/2} = u^n - \frac{\dt}{2} \lambda^n b^n \\
  b^{n+1} - c = 0
 \end{cases}&& \\
 & \quad \text{and, } \\
 & \quad 
 \begin{cases}
  u^{n+1} = u^{n+1/2} - \frac{\dt}{2} \hat{\lambda}^{n+1} b^{n+1} \\
  u^{n+1} \cdot b^{n+1} = 0.
 \end{cases} 
\end{flalign*}

For clarity, we note that the constraint in the first bracketed section of the algorithm is used to find the Lagrange multiplier \(\lambda^n\) such that the constraint is satisfied, which is then used to calculate \(u^{n+1/2}\) and hence \(m^{n+1}\). We do this using an iterative method, such as Newton. For the second bracketed section, the Lagrange multiplier \(\hat{\lambda}^{n+1}\) can be calculated directly from the constraint with no need for an iterative method.

Pseudo-Code for Algorithm 1:
\begin{flalign*}
& \quad \text{Set } m^0, u^0, \text{ and define }b^0 = \nabla{d^{2}_{\Sb}(m^0)} && \\
& \quad \text{FOR } n = 0,1,\dots \\
& \quad \quad \text{Solve, for } \lambda^n: h(\lambda^n) := d^{2}_{\Sb}(m^n + \dt + u^n - \frac{\dt}{2} \lambda^n b^n) - c = 0 \\
& \quad \quad \text{Set } u^{n+1/2} = u^n - \frac{\dt}{2} \lambda^n b^n \\
& \quad \quad \text{Set } m^{n+1} = m^{n} + \dt \; u^{n+1/2} \\
& \quad \quad \text{Set } b^{n+1} = \nabla{d^{2}_{\Sb}(m^{n+1})} \\
& \quad \quad \text{Set } \hat{\lambda}^{n+1} = \frac{2 \; u^{n+1} \cdot b^{n+1}}{\dt \; || b^{n+1} || ^2} \\
& \quad \quad \text{Set } u^{n+1} = u^{n+1/2} - \frac{\dt}{2} \hat{\lambda}^{n+1} b^{n+1}
\end{flalign*}

Upon using this algorithm on the Beltrami flow example, we found that it did not behave as desired. [see results]. The reason being that the constraint was possibly not capturing the full picture. The equality constraint was used assuming that the initial distance from incompressible \(c\) was the best we could do. However, what we observed was that the particle positions were sometimes falling inside this distance, and thus the constraint was actually harming the solution.

To solve this problem, we changed the constraint to an inequality constraint, so that we just desire that the particle positions lie within the the tolerance \(c\) from incompressible. Thus, we our problem is
\begin{align}
 &\begin{cases}
  \dot{m} = u \\
  \dot{u} = \lambda \graddsmsq, \quad \lambda = \lambda(t) \text{ a Lagrange multiplier enforcing } \dsmsq \le c.
 \end{cases} 
\end{align}

and our modified RATTLE algorithm, applied to this problem, is then:

Algorithm 2:
\begin{flalign*}
 & \quad \text{IF } (m^n + \dt \; u^n < c) && \\
 & \quad \quad \text{set } m^{n+1} = m^n + \dt \; u^n, \: \: u^{n+1} = u^n \\
 & \quad \text{ELSE } \\
 & \quad \quad \begin{cases}
  m^{n+1} = m^{n} + \dt \; u^{n+1/2}  \\
  u^{n+1/2} = u^n - \frac{\dt}{2} \lambda^n b^n \\
  b^{n+1} - c = 0
 \end{cases} \\
 & \quad \quad \text{and, } \\
 & \quad \quad \begin{cases}
  u^{n+1} = u^{n+1/2} - \frac{\dt}{2} \hat{\lambda}^{n+1} b^{n+1} \\
  u^{n+1} \cdot b^{n+1} = 0.
 \end{cases} 
\end{flalign*}

Pseudo-Code for Algorithm 2:
\begin{flalign*}
& \quad \text{Set } m^0, u^0, \text{ and define }b^0 = \nabla{d^{2}_{\Sb}(m^0)} && \\
& \quad \text{FOR } n = 0,1,\dots \\
& \quad \quad \text{IF } (m^n + \dt \; u^n < c) && \\
& \quad \quad \quad \text{Set } m^{n+1} = m^n + \dt \; u^n \\
& \quad \quad \quad \text{Set } u^{n+1} = u^n \\
& \quad \quad \text{ELSE } \\
& \quad \quad \quad \text{Solve, for } \lambda^n: h(\lambda^n) := d^{2}_{\Sb}(m^n + \dt + u^n - \frac{\dt}{2} \lambda^n b^n) - c = 0 \\
& \quad \quad \quad \text{Set } u^{n+1/2} = u^n - \frac{\dt}{2} \lambda^n b^n \\
& \quad \quad \quad \text{Set } m^{n+1} = m^{n} + \dt \; u^{n+1/2} \\
& \quad \quad \quad \text{Set } b^{n+1} = \nabla{d^{2}_{\Sb}(m^{n+1})} \\
& \quad \quad \quad \text{Set } \hat{\lambda}^{n+1} = \frac{2 \; u^{n+1} \cdot b^{n+1}}{\dt \; || b^{n+1} || ^2} \\
& \quad \quad \quad \text{Set } u^{n+1} = u^{n+1/2} - \frac{\dt}{2} \hat{\lambda}^{n+1} b^{n+1}
\end{flalign*}

\section{Results}




\section{Summary and Outlook}

In this report we have looked at setting out a potential new timestepping method for the incompressible Euler equations that involves optimal transport and a constrained symplectic algorithm. [Why is it good?] We have given some background to the method, as well as establishing its convergence numerically using a couple of examples. 

When looking at implementing on the Eady model problem itself, we encountered issues relating to the aspect ratio of the large domain (about 100x larger in the horizontal than the vertical). One solution to this latter problem could be to redefine the distance metric used in the Laguerre cells definition given, to "penalise" distance moved in the vertical direction by the appropriate amount (the ratio). Ultimately, we would look to gain a mathematical proof for convergence and stability of the method, and look to implement it for the full Eady model problem with periodic boundary conditions, and see how it compares to the Eulerian solution.


\end{document}











  